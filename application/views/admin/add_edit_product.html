<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
	<meta charset="utf-8" />
	<title>Metronic | Admin Dashboard Template</title>
	<meta content="width=device-width, initial-scale=1.0" name="viewport" />
	<meta content="" name="description" />
	<meta content="" name="author" />
	<!-- BEGIN GLOBAL MANDATORY STYLES -->
	<link href="media/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
	<link href="media/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"/>
	<link href="media/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
	<link href="media/css/style-metro.css" rel="stylesheet" type="text/css"/>
	<link href="media/css/style.css" rel="stylesheet" type="text/css"/>
	<link href="media/css/style-responsive.css" rel="stylesheet" type="text/css"/>
	<link href="media/css/default.css" rel="stylesheet" type="text/css" id="style_color"/>
	<link href="media/css/uniform.default.css" rel="stylesheet" type="text/css"/>
	<link href="media/css/my-style.css" rel="stylesheet" type="text/css"/>
	<!-- END GLOBAL MANDATORY STYLES -->


	<!--page css-->
	<link href="media/css/bootstrap-fileupload.css" rel="stylesheet" type="text/css"/>

	<link rel="shortcut icon" href="media/image/favicon.ico" />
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<body class="page-header-fixed page-sidebar-fixed page-sidebar-closed">
<!-- BEGIN HEADER -->
<div class="header navbar navbar-inverse navbar-fixed-top">
	<!-- BEGIN TOP NAVIGATION BAR -->
	<div class="navbar-inner">
		<div class="container-fluid">
			<!-- BEGIN LOGO -->
			<a class="brand" href="index.html">
				<img src="media/image/logo.png" alt="logo"/>
			</a>
			<!-- END LOGO -->
			<!-- BEGIN RESPONSIVE MENU TOGGLER -->
			<a href="javascript:;" class="btn-navbar collapsed" data-toggle="collapse" data-target=".nav-collapse">
				<img src="media/image/menu-toggler.png" alt="" />
			</a>
			<!-- END RESPONSIVE MENU TOGGLER -->
			<!-- BEGIN TOP NAVIGATION MENU -->
			<ul class="nav pull-right">
				<!-- BEGIN USER LOGIN DROPDOWN -->
				<li class="dropdown user">
					<a href="javascript:void(0)" style="background:none!important" class="dropdown-toggle my_nobg">
						<span class="username my_header_span">华东地区</span>
					</a>
				</li>
				<li class="dropdown user">
					<a href="#" style="background:none!important" class="dropdown-toggle my_nobg">
						<span class="username my_header_span my_underline">退出</span>
					</a>
				</li>
				<!-- END USER LOGIN DROPDOWN -->
			</ul>
			<!-- END TOP NAVIGATION MENU -->
		</div>
	</div>
	<!-- END TOP NAVIGATION BAR -->
</div>
<!-- END HEADER -->
<!-- BEGIN CONTAINER -->
<div class="page-container">
	<!-- BEGIN SIDEBAR -->
	<div class="page-sidebar nav-collapse collapse">
		<!-- BEGIN SIDEBAR MENU -->
		<ul class="page-sidebar-menu">
			<li style="margin-bottom:15px">
				<!-- BEGIN SIDEBAR TOGGLER BUTTON -->
				<div class="sidebar-toggler hidden-phone"></div>
				<!-- BEGIN SIDEBAR TOGGLER BUTTON -->
			</li>
			<li class="start active ">
				<a href="index.html">
					<i class="icon-home"></i>
					<span class="title">PG管理</span>
					<span class="selected"></span>
					<span class="arrow "></span>
				</a>
				<ul class="sub-menu">
					<li class="active"><a href="index.html">新建</a></li>
					<li><a href="index.html">PG列表</a></li>
				</ul>
			</li>
			<li class="">
				<a href="javascript:;">
					<i class="icon-cogs"></i>
					<span class="title">查看订单</span>
					<span class="arrow "></span>
				</a>
				<ul class="sub-menu">
					<li ><a href="layout_horizontal_sidebar_menu.html">子菜单</a></li>
					<li ><a href="layout_horizontal_sidebar_menu.html">子菜单</a></li>
					<li ><a href="layout_horizontal_sidebar_menu.html">子菜单</a></li>
				</ul>
			</li>
			<li class="">
				<a href="index.html">
					<i class="icon-home"></i>
					<span class="title">PG管理</span>
					<span class="selected"></span>
				</a>
			</li>
			<li class="">
				<a href="index.html">
					<i class="icon-home"></i>
					<span class="title">PG管理</span>
					<span class="selected"></span>
				</a>
			</li>
		</ul>
		<!-- END SIDEBAR MENU -->
	</div>
	<!-- END SIDEBAR -->
	<!-- BEGIN PAGE -->
	<div class="page-content">
		<!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
		<div id="portlet-config" class="modal hide">
			<div class="modal-header">
				<button data-dismiss="modal" class="close" type="button"></button>
				<h3>Widget Settings</h3>
			</div>
			<div class="modal-body">
				Widget settings form goes here
			</div>
		</div>
		<!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
		<!-- BEGIN PAGE CONTAINER-->
		<div class="container-fluid">
			<!-- BEGIN PAGE HEADER-->
			<div class="row-fluid">
				<div class="span12">
					<!-- BEGIN PAGE TITLE & BREADCRUMB-->
					<h3 class="page-title portlet-title">
						添加/编辑兑换商品<small></small>
						<span class="pull-right" style="font-size:30px"><a class="my_back" href="#">返回</a></span>
					</h3>

					<!-- END PAGE TITLE & BREADCRUMB-->
				</div>
			</div>
			<!-- END PAGE HEADER-->
			<div id="dashboard">
				<!-- BEGIN DASHBOARD STATS -->
				<div class="row-fluid">
					<div class="portlet-body">
						<form action="#" class="form-horizontal" id="add_goods">
							<div class="control-group">
								<label class="control-label my_form_label">
									<select class="small m-wrap" tabindex="1" name="type">
										<option value="">请选择分类</option>
										<option value="Category 1">Category 1</option>
										<option value="Category 2">Category 2</option>
										<option value="Category 3">Category 5</option>
										<option value="Category 4">Category 4</option>
									</select>
								</label>
								<div class="controls">
									<input type="text" class="span6 m-wrap" placeholder="商品名称" name="name" />
									<span class="help-inline"></span>
								</div>
							</div>
							<div class="control-group">
								<label class="control-label my_color_grey">请输入商品简介：</label>
								<div class="controls">
									<input type="text" name="content" class="span6 m-wrap"
										   placeholder="商品简介（限20字）" />
									<span class="help-inline"></span>
								</div>
							</div>
							<div class="control-group">
								<label class="control-label my_color_red">请选择图片：</label>
								<div class="controls">
									<div class="fileupload fileupload-new span6" data-provides="fileupload">
										<div class="input-append">
											<div class="uneditable-input">
												<i class="icon-file fileupload-exists"></i>
												<span class="fileupload-preview"></span>
											</div>
													<span class="btn btn-file">
													<span class="fileupload-new">选择图片</span>
													<span class="fileupload-exists">更改</span>
													<input type="file" class="default" id="img_file" />
													</span>
											<a href="#" class="btn fileupload-exists" data-dismiss="fileupload">移除</a>
										</div>
									</div>
									<input type="hidden" name="image"/>
									<span class="help-inline"></span>
								</div>
							</div>
							<!--progress-->
							<div class="control-group" style="display:none" id="progress">
								<label class="control-label my_color_grey"></label>
								<div class="controls">
									<div class="progress progress-striped progress-success active span6"
										 style="min-height:20px; margin-top:-15px">
										<div style="width: 0%;" class="bar" id="progress_bar"></div>
									</div>
								</div>
							</div>

							<div class="control-group">
								<label class="control-label my_color_red">请选择规格：</label>
								<div class="controls">
									<div class="my_product_line">
										<select class="small m-wrap" tabindex="1">
											<option value="">请选择分类</option>
											<option value="Category 1">Category 1</option>
											<option value="Category 2">Category 2</option>
											<option value="Category 3">Category 5</option>
											<option value="Category 4">Category 4</option>
										</select>
										&nbsp;&nbsp;&nbsp;&nbsp;尊享价：<input type="text" class="span1 m-wrap my_align_center"/>积分
										&nbsp;&nbsp;&nbsp;&nbsp;库存：<input type="text" class="span1 m-wrap my_align_center"/>件
										<span class="help-inline"></span>
									</div>
									<a class="edit my_edit" href="javascript:void(0)" id="add_size_line">+添加规格</a>
								</div>
							</div>
							<div class="control-group">
								<label class="control-label my_color_red"></label>
								<div class="controls">
									<input type="hidden" name="total" />
									<span class="help-inline"></span>
								</div>
							</div>
							<div class="control-group">
								<label class="control-label my_color_grey">请输入详细描述：</label>
								<div class="controls">
									<textarea class="span6 m-wrap" rows="3" placeholder="详细描述"></textarea>
									<span class="help-inline"></span>
								</div>
							</div>
							<div class="control-group">
								<label class="control-label my_color_grey">上架：</label>
								<div class="controls" style="line-height:30px">
									<label class="checkbox">
										<input type="checkbox" value="" /><span>（此为选填项，勾选后商品同步上架）</span>
									</label>
								</div>
							</div>

							<div class="form-actions">
								<button type="submit" class="btn black" id="submit">确 定</button>
								<button type="reset" class="btn">重 置</button>
							</div>
						</form>
					</div>
				</div>
				<!-- END DASHBOARD STATS -->
			</div>
		</div>
		<!-- END PAGE CONTAINER-->
	</div>
	<!-- END PAGE -->
</div>
<!-- END CONTAINER -->
<!-- BEGIN FOOTER -->
<div class="footer">
	<div class="footer-inner">
		2015 &copy; 互赢网络
	</div>
	<div class="footer-tools">
			<span class="go-top">
			<i class="icon-angle-up"></i>
			</span>
	</div>
</div>
<!--common js-->
<script src="media/js/jquery-1.10.1.min.js" type="text/javascript"></script>
<script src="media/js/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
<script src="media/js/jquery-ui-1.10.1.custom.min.js" type="text/javascript"></script>
<script src="media/js/bootstrap.min.js" type="text/javascript"></script>
<!--[if lt IE 9]>
<script src="media/js/excanvas.min.js"></script>
<script src="media/js/respond.min.js"></script>
<![endif]-->
<script src="media/js/jquery.uniform.min.js" type="text/javascript" ></script>
<script src="media/js/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="media/js/jquery.cookie.min.js" type="text/javascript"></script>
<script src="media/js/app.js" type="text/javascript"></script>
<script>
	jQuery(document).ready(function() {
		App.init(); // initlayout and core plugins
	});
</script>




<!--page js-->
<script type="text/javascript" src="media/js/jquery.validate.min.js"></script>
<script type="text/javascript" src="media/js/form-validation.js"></script>
<script type="text/javascript" src="media/js/bootstrap-fileupload.js"></script>
<script type="text/javascript" src="media/js/form-components.js"></script>
<script>
	jQuery(document).ready(function() {
		$('#submit').click(function(e){
			var totalSize=[];
			$('.my_product_line').each(function(){
				var size=[];
				$(this).find('.m-wrap').each(function(){
					var val=$(this).val()?$(this).val():'null';
					size.push(val)
				});
				totalSize.push(size.join(','))
			});
			totalSize=totalSize.join('-');
			console.log(totalSize);
			if(totalSize.indexOf('null')>=0){
				totalSize=''
			}
			$('[name=total]').val(totalSize);
			$('#add_goods').submit()
		});
		$('#add_goods').validate({
			errorElement: 'span', //default input error message container
			errorClass: 'error', // default input error message class
			focusInvalid: false, // do not focus the last invalid input
			ignore: "",
			rules: {
				type:{
					required: true
				},
				name: {
					required: true
				},
				image: {
					required: true
				},
				total:{
					required: true
				},
				store: {
					required: true
				}
			},
			messages: {
				type:{
					required: '请选择分类'
				},
				name:{
					required: "名称不能为空"
				},
				image: {
					required: ''
				},
				total:{
					required: '规格填写不完整'
				},
				store:{
					required: "门店不能为空"
				}
			},
			errorPlacement: function(error, element) {
				element.next().text(error.text())
			},
			highlight: function (element) { // hightlight error inputs
				$(element).closest('.help-inline').removeClass('ok'); // display OK icon
				$(element).closest('.control-group').removeClass('success').addClass('error'); // set error class to the control group
			},
			unhighlight: function (element) { // revert the change dony by hightlight
				$(element).closest('.control-group').removeClass('error'); // set error class to the control group
				$(element).next().text('')
			}
		});

		var line=$('.my_product_line').eq(0).clone(true);
		var count=1;
		$('#add_size_line').click(function(){
			var l=line.clone(true);
			var del=$('<a href="javascript:void(0)" style="margin-left:20px">删除规格</a>');
			del.click(function(){
				$(this).parents('.my_product_line').remove()
			});
			l.append(del);
			$(this).before(l)
		});

		//upload
		$('#img_file').change(function(e){
			var xhr = new XMLHttpRequest();
			var upload = xhr.upload;console.log(this.files);
			var file= this.files[0];
			upload.addEventListener("progress", function(e){
				if (e.lengthComputable) {
					$('#progress').fadeIn(500);
					var percentage = Math.round((e.loaded * 100) / e.total);
					console.log(percentage);
					$('#progress_bar').width(percentage+'%');
					if(percentage>=100){
						$('[name=image]').val('ok');
						$('#progress').fadeOut(500);
					}
				}
			}, false);
			xhr.open("POST", '/', true);
			xhr.sendAsBinary(file)
		});

		XMLHttpRequest.prototype.sendAsBinary = function(file) {
			var formData2 = new FormData();
			formData2.append('file',file);
			this.send(formData2)
		}
	});
</script>
</body>
<!-- END BODY -->
</html>